目标：
我需要在browser-use中增加一套网络请求/响应捕获的watchdog，捕获在agent运行的生命周期中，浏览器中发生的所有http通信流量，以便后续基于捕获的http通信进行渗透测试。

需求特性：方案需要满足以下需求特性
1. 捕获所有http的通信流量，但支持基于配置保留适合渗透测试的流量。可基于http的host/域名/IP等配置保留哪些站点的流量，可基于文件后缀名、content-type等配置过滤掉静态资源流量；
2. 对于http请求，需要同步记录触发该请求的前端页面的url、title、dom节点等信息（特别是vue/react等前后端分离框架中、SPA页面中，请求/响应中的url与实际触发该请求的前端url可能不一致），以便后续测试时能快速了解如何从前端复现对后端的测试构造；
3. 对于http流量，需要成对的捕获完整的请求/响应流量（包括成对的http request [ url、method、headers、body]，http response[code、 headers、body]，以上中括号中都是必须记录的信息字段，不能遗漏）。watchdog使用异步机制，需要注意捕获请求和响应可能不在同一个事件中，要考虑如何准确无误的进行请求/响应的成对匹配和保存。
4. 在完成一对http请求（及其关联前端信息）/响应后，需要及时将捕获的需要保留的（遵循1中的配置）信息存储到配置中的redis，每次缓存前先通过对比缓存中是否已有request的url、method、请求body相同的内容（或者browser中是否有缓存标识？），减少重复的捕获和缓存、减轻内存压力，同时避免cdp生命周期机制导致某些响应数据丢失。在agent生命周期即将结束时，将redis中保留的所有数据持久化存储到配置的数据库中。在watchdog的相关实现中要应用redis、数据库处理。
5. 需要考虑请求/响应体可能非常大，尤其是响应body，需要在浏览器配置中设计可配置的大小上限，并在保存时按照配置大小进行截断（丢弃超出大小的后半部分内容）。
6. 捕获保存的流量，需要每次从调用捕获机制的browser-use的agent会话中提取conversation_id，用来区分流量是从哪个agent任务捕获的。

方案内容：方案需要详细设计以下内容
1. 事件声明，要结合需要捕获的请求（及其关联前端信息）/响应数据需求合理声明事件；
2. 事件处理逻，需要关注cdp中对每个请求/响应的生命周期机制，避免请求/响应中的字段在销毁后无法被正确捕获；
3. 事件分发位置，在目前browser-use中，何处分发事件能保证需求能合理达成？如何正确监听cdp的原生事件来保证捕获目标达成？是否要在捕获处理过程中触发其他事件机制等；
4. 事件销毁，合理的进行销毁；
5. 事件异常处理，在捕获过程中出现异常时进行合理处理。

注意事项：
1. 要基于对browser-use的agent、cdp、watchdog等机制的分析，结合需求特性中的要求来设计方案；
2. 整体设计要符合当前browser-use整体目录结构设计，既要不脱离已有browser-use体系，又要注意保持相对独立可维护。
3. 方案中要标识每段代码存放位置，包括是否新建代码文件，新建的代码文件名和位置目录；是否修改原代码，修改文件的文件名和位置，各个代码段分别实现了什么功能等，在修改browser-use原文件代码时需要统一增加注释“# network capture feature code”，以便我能快速搜索到方案设计的代码文件和代码片段。
4. 流量捕获开关、流量捕获过滤配置设计在browser session或browser profile中；redis、数据库的配置设计为从项目.env文档中读取。
5. 这套watchdog中的日志记录级别保持与browser-use一致，较底层、细致的日志作为debug级输出，用来进行异常和排障使用，流量捕获业务层的作为info级输出。
6. 仅输出方案文档，暂时不修改代码。
